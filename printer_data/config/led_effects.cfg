# ===================== LED Effects & Strips =====================

[led_effect bed_leds]
autostart: False                 # start via delayed_gcode after 5s
frame_rate: 24
heater: heater_bed
leds: neopixel:under_lights (54-125)
layers:
    temperaturegauge 20 70 top (.25,.0,.0),(0.19,.0,.0),(0.14,.0,.0),(.2,0.15,0),(.2,0.215,0),(.0,.0,.1),(0,.0,.1),(0,.0,.1)

# Turn bed_leds on 5 seconds after Klipper restart
[delayed_gcode START_BED_LEDS]
initial_duration: 5.0
gcode:
  {% if printer.configfile.config.get('led_effect bed_leds') is not none %}
    SET_LED_EFFECT EFFECT=bed_leds REPLACE=1
  {% endif %}

[led_effect hotend_leds]
autostart: True
frame_rate: 24
heater: extruder
leds: neopixel:my_neopixel (59-131)
layers:
    temperaturegauge 22 235 top (.25,.0,.0),(0.19,.0,.0),(0.14,.0,.0),(.2,0.15,0),(.2,0.215,0),(.0,.0,.1),(0,.0,.1),(0,.0,.1)

[led_effect rainbow_leds]
leds: neopixel:under_lights (1-53)
autostart: False
frame_rate: 24
layers:
    gradient 0.3 1 add (0.3,0.0,0.0),(0.0,0.3,0.0),(0.0,0.0,0.3)

[led_effect under_standby_leds]
leds: neopixel:under_lights (1-53)
autostart: True
frame_rate: 24
layers:
    linearfade 20 0 top (0,0,1),(1,0,0)

[led_effect set_nozzle_leds]
leds:
    neopixel:sb_leds (2,3)
autostart: True
frame_rate: 24
layers:
    static 0 0 top (0.0,0.0,0.0,0.6)

# ===================== Macros to switch effects =====================

[gcode_macro hotend_leds]
gcode:
    SET_LED_EFFECT EFFECT=hotend_leds REPLACE=1

[gcode_macro rainbow_leds]
gcode:
    SET_LED_EFFECT EFFECT=rainbow_leds REPLACE=1

[gcode_macro rainbow_leds_off]
gcode:
    SET_LED_EFFECT EFFECT=under_standby_leds REPLACE=1

# Optional quick toggles (handy but not required)
[gcode_macro BED_LEDS_ON]
gcode:
    SET_LED_EFFECT EFFECT=bed_leds REPLACE=1

[gcode_macro BED_LEDS_OFF]
gcode:
    SET_LED_EFFECT EFFECT=bed_leds STOP=1

[gcode_macro HOTEND_LEDS_OFF]
gcode:
    SET_LED_EFFECT EFFECT=hotend_leds STOP=1

# ===================== LED Strip Definitions =====================

[neopixel my_neopixel]
pin: PE6
chain_count: 132
color_order: GRB
initial_RED: .7
initial_GREEN: .7
initial_BLUE: .7
initial_WHITE: 0.0

[neopixel under_lights]
pin: PE5
chain_count: 125
color_order: GRB
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 1.0
initial_WHITE: 0.0

[neopixel sb_leds]
pin: EBB:gpio15
chain_count: 3
color_order: GRBW
initial_RED: 1.0
initial_GREEN: 0
initial_BLUE: 0.0
initial_WHITE: 0.0
