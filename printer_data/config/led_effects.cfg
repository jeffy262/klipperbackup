# ===================== LED Effects & Strips =====================

[led_effect bed_leds]
autostart: False                 # start via delayed_gcode after 5s
frame_rate: 24
heater: heater_bed
leds: neopixel:under_lights (54-125)
layers:
    temperaturegauge 20 70 top (.25,.0,.0),(0.19,.0,.0),(0.14,.0,.0),(.2,0.15,0),(.2,0.215,0),(.0,.0,.1),(0,.0,.1),(0,.0,.1)

# Turn bed_leds on 5 seconds after Klipper restart
[delayed_gcode START_BED_LEDS]
initial_duration: 5.0
gcode:
  {% if printer.configfile.config.get('led_effect bed_leds') is not none %}
    SET_LED_EFFECT EFFECT=bed_leds REPLACE=1
  {% endif %}

[led_effect hotend_leds]
autostart: True
frame_rate: 24
heater: extruder
leds: neopixel:my_neopixel (59-131)
layers:
    temperaturegauge 22 235 top (.25,.0,.0),(0.19,.0,.0),(0.14,.0,.0),(.2,0.15,0),(.2,0.215,0),(.0,.0,.1),(0,.0,.1),(0,.0,.1)

[led_effect rainbow_leds]
leds: neopixel:under_lights (1-53)
autostart: False
frame_rate: 24
layers:
    gradient 0.3 1 add (0.3,0.0,0.0),(0.0,0.3,0.0),(0.0,0.0,0.3)

[led_effect under_standby_leds]
leds: neopixel:under_lights (1-53)
autostart: True
frame_rate: 24
layers:
    linearfade 20 0 top (0,0,1),(1,0,0)

# ===================== Minimal switch helpers (kept) =====================

[gcode_macro hotend_leds]
gcode:
    SET_LED_EFFECT EFFECT=hotend_leds REPLACE=1

[gcode_macro rainbow_leds]
gcode:
    SET_LED_EFFECT EFFECT=rainbow_leds REPLACE=1

# ===================== LED Strip Definitions =====================

[neopixel my_neopixel]
pin: PE6
chain_count: 132
color_order: GRB
initial_RED: .7
initial_GREEN: .7
initial_BLUE: .7
# (GRB strip has no white channel)

[neopixel under_lights]
pin: PE5
chain_count: 125
color_order: GRB
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 1.0
# (GRB strip has no white channel)

[neopixel sb_leds]
pin: EBB:gpio15
chain_count: 3
color_order: GRBW
initial_RED: 1.0
initial_GREEN: 0
initial_BLUE: 0.0
initial_WHITE: 0.0

######################################################################
#                        StealthBurner sb_leds                        #
#                    GRBW (logo = LED 1, nozzle = 2-3)               #
######################################################################

# ---- Logo effects (LED 1) ----
[led_effect sb_logo_busy]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    breathing 3 1 top (1.0, 0.0, 0.0, 0.0)              # red

[led_effect sb_logo_cleaning]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    breathing 3 1 top (0.0, 0.02, 0.5, 0.0)            # blue-ish

[led_effect sb_logo_calibrating_z]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    breathing 3 1 top (0.0, 0.0, 0.35, 0.0)            # blue

[led_effect sb_logo_heating]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    breathing 3 1 top (1.0, 0.18, 0.0, 0.0)            # orange

[led_effect sb_logo_cooling]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    breathing 3 1 top (0.0, 0.0, 1.0, 0.0)             # blue

[led_effect sb_logo_homing]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    breathing 3 1 top (0.0, 0.6, 0.2, 0.0)             # teal/green

[led_effect sb_logo_leveling]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    breathing 3 1 top (0.5, 0.1, 0.4, 0.0)             # purple-ish

[led_effect sb_logo_meshing]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    breathing 3 1 top (0.2, 1.0, 0.0, 0.0)             # lime

[led_effect sb_logo_printing]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    gradient 0.3 1 add (0.3,0.0,0.0,0.0),(0.3,0.3,0.0,0.0),(0.3,0.1,0.0,0.0)

[led_effect sb_logo_standby]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (1)
layers:
    breathing 3 1 top (0.01, 0.01, 0.01, 0.0)          # very dim

# Optional: pure white using W channel
[led_effect set_logo_leds]
leds:
    neopixel:sb_leds (1)
autostart: false
frame_rate: 24
layers:
    static 0 0 top (0.0, 0.0, 0.0, 1.0)                # W only = clean white

# Logo OFF
[led_effect sb_logo_off]
leds:
    neopixel:sb_leds (1)
autostart: false
frame_rate: 24
layers:
    static 0 0 top (0.0, 0.0, 0.0, 0.0)

# ---- Nozzle effects (LEDs 2-3) ----
[led_effect sb_nozzle_heating]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (2,3)
layers:
    breathing 3 1 top (1.0, 0.18, 0.0, 0.0)            # orange

[led_effect sb_nozzle_cooling]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (2,3)
layers:
    breathing 3 1 top (0.0, 0.0, 1.0, 0.1)             # blue + touch W

[led_effect sb_nozzle_standby]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (2,3)
layers:
    breathing 3 1 top (0.6, 0.0, 0.0, 0.0)             # dim red

[led_effect sb_nozzle_part_ready]
autostart: false
frame_rate: 24
leds:
    neopixel:sb_leds (2,3)
layers:
    breathing 3 1 top (0.6, 1.0, 0.0, 0.1)             # yellow-green + W

# Nozzle ON (static white via W channel)
[led_effect set_nozzle_leds]
leds:
    neopixel:sb_leds (2,3)
autostart: false
frame_rate: 24
layers:
    static 0 0 top (0.0, 0.0, 0.0, 1.0)

# Nozzle OFF
[led_effect sb_nozzle_off]
leds:
    neopixel:sb_leds (2,3)
autostart: false
frame_rate: 24
layers:
    static 0 0 top (0.0, 0.0, 0.0, 0.0)

# ---- All-sb critical/error & rainbow ----
[led_effect sb_critical_error]
leds:
    neopixel:sb_leds
layers:
    strobe      1  1.5   add        (1.0,  1.0, 1.0, 0.0)
    breathing   2  0     difference (0.95, 0.0, 0.0, 0.0)
    static      1  0     top        (1.0,  0.0, 0.0, 0.0)
autostart: false
frame_rate: 24
run_on_error: true

[led_effect rainbow]
leds:
    neopixel:sb_leds
autostart: true
frame_rate: 24
layers:
    gradient 0.3 1 add (0.3,0.0,0.0,0.0),(0.0,0.3,0.0,0.0),(0.0,0.0,0.3,0.0)

################
# Status Macros (kept)
################

[gcode_macro status_off]
gcode:
    ; turn both zones off (logo + nozzle)
    SET_LED_EFFECT EFFECT=sb_logo_off REPLACE=1
    SET_LED_EFFECT EFFECT=sb_nozzle_off REPLACE=1

[gcode_macro status_ready]
gcode:
    SET_LED_EFFECT EFFECT=rainbow REPLACE=1

[gcode_macro status_part_ready]
gcode:
    SET_LED_EFFECT EFFECT=sb_logo_part_ready REPLACE=1
    SET_LED_EFFECT EFFECT=sb_nozzle_part_ready REPLACE=1

[gcode_macro status_busy]
gcode:
    SET_LED_EFFECT EFFECT=sb_logo_busy REPLACE=1
    SET_LED_EFFECT EFFECT=set_nozzle_leds REPLACE=1

[gcode_macro status_heating]
gcode:
    SET_LED_EFFECT EFFECT=sb_logo_heating REPLACE=1
    SET_LED_EFFECT EFFECT=sb_nozzle_heating REPLACE=1

[gcode_macro status_cooling]
gcode:
    SET_LED_EFFECT EFFECT=sb_logo_cooling REPLACE=1
    SET_LED_EFFECT EFFECT=sb_nozzle_cooling REPLACE=1

[gcode_macro status_leveling]
gcode:
    SET_LED_EFFECT EFFECT=sb_logo_leveling REPLACE=1
    SET_LED_EFFECT EFFECT=set_nozzle_leds REPLACE=1

[gcode_macro sb_status_homing]
gcode:
    SET_LED_EFFECT EFFECT=sb_logo_homing REPLACE=1
    SET_LED_EFFECT EFFECT=set_nozzle_leds REPLACE=1

[gcode_macro status_cleaning]
gcode:
    SET_LED_EFFECT EFFECT=sb_logo_cleaning REPLACE=1
    SET_LED_EFFECT EFFECT=set_nozzle_leds REPLACE=1

[gcode_macro status_meshing]
gcode:
    SET_LED_EFFECT EFFECT=sb_logo_meshing REPLACE=1
    SET_LED_EFFECT EFFECT=set_nozzle_leds REPLACE=1

[gcode_macro status_calibrating_z]
gcode:
    SET_LED_EFFECT EFFECT=sb_logo_calibrating_z REPLACE=1
    SET_LED_EFFECT EFFECT=set_nozzle_leds REPLACE=1

