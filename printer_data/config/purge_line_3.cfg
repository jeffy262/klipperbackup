[gcode_macro PURGE_LINE_3]
description: Two-line prime line at front of bed
# Defaults – adjust as needed
variable_start_x: 165
variable_start_y: 25
variable_z: 0.28                  # first layer Z
variable_length: 100              # mm per line
variable_gap: 2.0                 # mm between the two lines
variable_speed: 1200              # mm/min
variable_e_per_mm: 0.14           # extrusion per mm of line (tune for your setup)
variable_cleanup_retract: 1.0     # mm retract at end

gcode:
  {% if printer.toolhead.homed_axes != "xyz" %}
    RESPOND TYPE=info MSG="PURGE_LINE_2 skipped: not homed."
  {% elif printer.extruder.temperature < printer.configfile.settings.extruder.min_extrude_temp %}
    RESPOND TYPE=info MSG="PURGE_LINE_2 skipped: hotend too cold."
  {% else %}
    SAVE_GCODE_STATE NAME=PL2
    G90
    M83
    G92 E0

    ; line 1
    G1 X{start_x} Y{start_y} Z{z} F6000
    G1 X{start_x + length} E{length * e_per_mm} F{speed}

    ; hop & offset
    G1 Z{z + 0.05} F3000
    G1 X{start_x + length} Y{start_y + gap} F6000
    G1 Z{z} F3000

    ; line 2 back
    G1 X{start_x} E{length * e_per_mm} F{speed}

    ; retract a little so nozzle doesn’t ooze
    G1 E-{cleanup_retract} F1800
    M82

    RESTORE_GCODE_STATE NAME=PL2
  {% endif %}
