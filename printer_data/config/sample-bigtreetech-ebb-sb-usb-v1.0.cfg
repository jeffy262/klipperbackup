# This file contains common pin mappings for the BIGTREETECH EBB USB board.
# To use this config, the firmware should be compiled for the RP2040 with "USB".
# The "EBB Can" micro-controller will be used to control the components on the nozzle.

# ---- EBB USB toolhead board ----
[mcu EBB]
serial: /dev/serial/by-id/usb-Klipper_rp2040_50443403106AD11C-if00

[temperature_sensor EBB_NTC]
sensor_type: Generic 3950
sensor_pin: EBB:gpio27

[extruder]
step_pin: EBB:gpio18
dir_pin: EBB:gpio19
enable_pin: !EBB:gpio17
microsteps: 16

# If your extruder really is 9:1, keep gear_ratio.
# rotation_distance must be calibrated for YOUR drive gear + ratio.
rotation_distance: 47.088         # <-- verify by 100 mm extrusion test
gear_ratio: 9:1

nozzle_diameter: 0.60             # <-- set to your actual nozzle (e.g., 0.40)
filament_diameter: 1.75

heater_pin: EBB:gpio7
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: EBB:gpio26
pullup_resistor: 2200             # BTT EBB uses 2.2k pullup

control: pid
pid_Kp: 31.394
pid_Ki: 3.431
pid_Kd: 71.813

min_temp: 10
max_temp: 290
min_extrude_temp: 170             # <-- safety! adjust per filament family

# Safety: set to a realistic printed cross-section (mm^2).
# Example for 0.4 nozzle, 0.2 layer, ~0.48 width -> 0.48*0.2=0.096 mm^2 (round up a bit).
# For a 1.0 mm nozzle at 0.4 layer with ~1.2 width -> ~0.48 mm^2 (set e.g. 0.8â€“1.0).
max_extrude_cross_section: 1.00   # <-- pick a sane value for your nozzle/layer

max_extrude_only_distance: 120

[tmc2209 extruder]
uart_pin: EBB:gpio20
run_current: 0.650
stealthchop_threshold: 999999

[heater_fan hotend_fan]
pin: EBB:gpio14
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 30

[fan]
pin: EBB:gpio4

# Only keep this if you truly need to reuse a pin already in use.
# [duplicate_pin_override]
# pins: EBB:gpio27

