[include mainsail.cfg]
[include led_effects.cfg]

[include screws_tilt_adjust.cfg]
#[include nebula.cfg]

[include moonraker_obico_macros.cfg]
#[virtual_sdcard]
##[display_status]
#[pause_resume]

[include wipe_nozzle_pause.cfg]

[include macros.cfg]

[include sample-bigtreetech-adxl345-v2.0.cfg]

[include knomi.cfg]

[include bigtreetech-eddy-zoffbeta.cfg]

[include sample-bigtreetech-ebb-sb-usb-v1.0.cfg]

[include ebbfan.cfg]

[include skr3fan.cfg]

[exclude_object]

[include WIPE_NOZZLE.cfg]

[include purge_line_2.cfg]


[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_070026001351333031373138-if00
# host MCU service is preinstalled and ready to use with:
#[mcu CB2]
#serial: /tmp/klipper_host_mcu

#[include generic-bigtreetech-xxx.cfg]

# This file contains common pin mappings for the BigTreeTech SKR 3.
# To use this config, the firmware should be compiled for the
# STM32H743 with a "128KiB bootloader".

# See docs/Config_Reference.md for a description of parameters.

[stepper_x]
step_pin: PD4
dir_pin: !PD3
enable_pin: !PD6
microsteps: 16
rotation_distance: 40
full_steps_per_rotation: 200
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: -2
#endstop_pin: ^PC1
position_endstop: 0
position_max: 430
homing_speed: 50
homing_retract_dist: 0
homing_positive_dir: false

[tmc2209 stepper_x]
uart_pin: PD5
diag_pin: ^PC1
driver_SGTHRS: 90
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.220
interpolate: True
stealthchop_threshold: 0

[stepper_y]
step_pin: PA15
dir_pin: !PA8
enable_pin: !PD1
microsteps: 16
rotation_distance: 40
#endstop_pin: ^PC3
full_steps_per_rotation: 200
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_min: -2
position_endstop: 0
position_max: 430
homing_speed: 50
homing_retract_dist: 0
homing_positive_dir: false

[tmc2209 stepper_y]
uart_pin: PD0
diag_pin: ^PC3
driver_SGTHRS: 80
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.220
interpolate: True
stealthchop_threshold: 0


[stepper_z]
step_pin: PE2
dir_pin: PE3
enable_pin: !PE0
microsteps:16
rotation_distance:8
endstop_pin: ^PC0
full_steps_per_rotation:200
endstop_pin: probe:z_virtual_endstop
position_min: -5
position_max: 395
homing_speed: 8
second_homing_speed: 3

[tmc2209 stepper_z]
uart_pin: PE1
run_current: 0.800
diag_pin: PC0
run_current: 0.53033
hold_current: 0.53033
sense_resistor: 0.220
interpolate: True
stealthchop_threshold: 999999

[filament_switch_sensor filament_sensor]
switch_pin:  ^PC15
pause_on_runout: True
insert_gcode:
    M117 Insert Detected


#[filament_motion_sensor filament_sensor]
#detection_length: 10
#extruder: extruder
#switch_pin: ^PC2
#pause_on_runout: True
#insert_gcode:
#    M117 Insert Detected
#runout_gcode:
#    M117 Runout Detected
    

[heater_bed]
heater_pin: PD7
sensor_type: Generic 3950
sensor_pin: PA1
#control: watermark
min_temp: 10
max_temp: 115



#[fan]
#Motherboard controler fan


[controller_fan motherboard_fan]
pin: PB7


[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_070026001351333031373138-if00

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3800
max_z_velocity: 40
max_z_accel: 160
square_corner_velocity: 8

[input_shaper]
shaper_freq_x: 41.4
shaper_type_x: mzv
shaper_freq_y: 33.0
shaper_type_y: ei





########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PC5, EXP1_3=PB1, EXP1_5=PE9,  EXP1_7=PE11, EXP1_9=<GND>,
    EXP1_2=PB0, EXP1_4=PE8, EXP1_6=PE10, EXP1_8=PE12, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PA6, EXP2_3=PE7, EXP2_5=PB2, EXP2_7=PC4,   EXP2_9=<GND>,
    EXP2_2=PA5, EXP2_4=PA4, EXP2_6=PA7, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

########################################
# TMC2209 configuration
########################################







#[tmc2209 extruder]
#uart_pin: PC6
#run_current: 0.600
#diag_pin:

#[tmc2209 extruder1]
#uart_pin: PD12
#run_current: 0.600
#diag_pin:

########################################
# TMC2130 configuration
########################################

#[tmc2130 stepper_x]
#cs_pin: PD5
#spi_software_miso_pin: PE15
#spi_software_mosi_pin: PE13
#spi_software_sclk_pin: PE14
#run_current: 0.800
#stealthchop_threshold: 999999
#diag1_pin: PC1

#[tmc2130 stepper_y]
#cs_pin: PD0
#spi_software_miso_pin: PE15
#spi_software_mosi_pin: PE13
#spi_software_sclk_pin: PE14
#run_current: 0.800
#stealthchop_threshold: 999999
#diag1_pin: PC3

#[tmc2130 stepper_z]
#cs_pin: PE1
#spi_software_miso_pin: PE15
#spi_software_mosi_pin: PE13
#spi_software_sclk_pin: PE14
#run_current: 0.650
#stealthchop_threshold: 999999
#diag1_pin: PC0

#[tmc2130 extruder]
#cs_pin: PC6
#spi_software_miso_pin: PE15
#spi_software_mosi_pin: PE13
#spi_software_sclk_pin: PE14
#run_current: 0.800
#stealthchop_threshold: 999999
#diag1_pin: PC2

#[tmc2130 extruder1]
#cs_pin: PD12
#spi_software_miso_pin: PE15
#spi_software_mosi_pin: PE13
#spi_software_sclk_pin: PE14
#run_current: 0.800
#stealthchop_threshold: 999999
#diag1_pin: PA0

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3252573.427,0.090000:3251756.501,0.130000:3250841.237,
#*# 	0.170000:3250003.581,0.210000:3249041.991,0.250000:3248204.023,
#*# 	0.290000:3247301.729,0.330000:3246443.918,0.370000:3245589.186,
#*# 	0.410000:3244755.063,0.450000:3243887.994,0.490000:3243066.088,
#*# 	0.530000:3242226.362,0.570000:3241400.120,0.610000:3240585.118,
#*# 	0.650000:3239788.510,0.690000:3238966.897,0.730000:3238191.540,
#*# 	0.770000:3237405.125,0.810000:3236662.230,0.850000:3235873.273,
#*# 	0.890000:3235145.025,0.930000:3234446.277,0.970000:3233750.771,
#*# 	1.010000:3233030.673,1.050000:3232346.352,1.090000:3231693.184,
#*# 	1.130000:3231051.053,1.170000:3230389.336,1.210000:3229752.565,
#*# 	1.250000:3229124.250,1.290000:3228524.722,1.330000:3227898.808,
#*# 	1.370000:3227296.343,1.410000:3226733.304,1.450000:3226175.135,
#*# 	1.490000:3225577.356,1.530000:3225032.935,1.570000:3224493.633,
#*# 	1.610000:3223974.093,1.650000:3223422.961,1.690000:3222918.563,
#*# 	1.730000:3222419.385,1.770000:3221902.430,1.810000:3221408.942,
#*# 	1.850000:3220932.596,1.890000:3220479.779,1.930000:3220006.660,
#*# 	1.970000:3219536.558,2.010000:3219109.536,2.050000:3218692.957,
#*# 	2.090000:3218260.054,2.130000:3217849.967,2.170000:3217444.753,
#*# 	2.210000:3217036.217,2.250000:3216656.016,2.290000:3216277.616,
#*# 	2.330000:3215895.229,2.370000:3215542.604,2.410000:3215199.031,
#*# 	2.450000:3214872.946,2.490000:3214516.643,2.530000:3214207.505,
#*# 	2.570000:3213871.146,2.610000:3213536.374,2.650000:3213219.112,
#*# 	2.690000:3212899.752,2.730000:3212615.375,2.770000:3212315.221,
#*# 	2.810000:3212000.735,2.850000:3211720.718,2.890000:3211431.105,
#*# 	2.930000:3211148.408,2.970000:3210886.352,3.010000:3210612.608,
#*# 	3.050000:3210348.939,3.090000:3210097.933,3.130000:3209815.504,
#*# 	3.170000:3209550.038,3.210000:3209339.529,3.250000:3209047.590,
#*# 	3.290000:3208805.337,3.330000:3208567.995,3.370000:3208329.177,
#*# 	3.410000:3208097.161,3.450000:3207894.435,3.490000:3207638.646,
#*# 	3.530000:3207430.689,3.570000:3207191.063,3.610000:3207000.077,
#*# 	3.650000:3206781.758,3.690000:3206582.513,3.730000:3206377.076,
#*# 	3.770000:3206181.701,3.810000:3205974.396,3.850000:3205796.292,
#*# 	3.890000:3205608.335,3.930000:3205457.407,3.970000:3205263.138,
#*# 	4.010000:3205115.177,4.050000:3204934.409
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 37.497261
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.051931, 0.048445, -0.000152, -0.013595, 0.001302, 0.023581, 0.054749, 0.062783, 0.101369, 0.144914, 0.255089
#*# 	  -0.019385, 0.017986, -0.023869, -0.048038, -0.026668, -0.006436, 0.030025, 0.042738, 0.062731, 0.106426, 0.085985
#*# 	  -0.002971, 0.041342, 0.000927, -0.024568, -0.012162, 0.003433, 0.009926, 0.004942, 0.023669, 0.050652, 0.065576
#*# 	  0.049886, 0.096123, 0.062082, 0.040431, 0.050807, 0.069486, 0.086322, 0.080400, 0.085005, 0.110798, 0.077745
#*# 	  0.061736, 0.119329, 0.082946, 0.058825, 0.066436, 0.075967, 0.084163, 0.070195, 0.065339, 0.074455, 0.066573
#*# 	  0.036227, 0.090930, 0.070761, 0.055650, 0.073103, 0.097844, 0.119840, 0.127772, 0.141637, 0.161351, 0.131010
#*# 	  0.031814, 0.092855, 0.078026, 0.067195, 0.095743, 0.116125, 0.132482, 0.114267, 0.118811, 0.142334, 0.147998
#*# 	  0.070942, 0.117524, 0.102222, 0.095983, 0.146728, 0.148064, 0.172512, 0.170050, 0.172063, 0.192152, 0.147534
#*# 	  0.139208, 0.187050, 0.154129, 0.132475, 0.139706, 0.153988, 0.173080, 0.158612, 0.143422, 0.149679, 0.118721
#*# 	  0.127159, 0.155177, 0.116261, 0.094990, 0.107038, 0.122215, 0.151007, 0.160178, 0.178634, 0.204247, 0.118406
#*# 	  -0.171532, -0.157439, -0.212125, -0.246885, -0.228884, -0.194785, -0.158342, -0.105145, -0.058940, -0.059777, -0.134282
#*# x_count = 11
#*# y_count = 11
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 400.0
#*# min_y = 30.0
#*# max_y = 400.0
#*#
#*# [input_shaper]
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 75.801
#*# pid_ki = 0.584
#*# pid_kd = 2461.642
#*#
#*# [bed_mesh current]
#*# version = 1
#*# points =
#*# 	0.007181, -0.013167, -0.023386, -0.079118
#*# 	0.041651, 0.031655, 0.014528, -0.022117
#*# 	0.064467, 0.053344, 0.036496, -0.013723
#*# 	0.088185, 0.133289, 0.070669, 0.026594
#*# x_count = 4
#*# y_count = 4
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 132.5
#*# max_x = 287.48
#*# min_y = 144.0
#*# max_y = 276.0
